<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BSCEEEY2S1 - Study Documents</title>
    <link rel="stylesheet" href="style.css">
     <link rel="icon" href="pngegg.png">
    <style>
        /* Your existing CSS styles */
        .collapsible {
            background-color: #f2f2f2;
            color: #000;
            cursor: pointer;
            padding: 12px;
            width: 100%;
            border: none;
            text-align: left;
            outline: none;
            font-size: 16px;
            font-weight: bold;
            border-bottom: 1px solid #ccc;
            transition: background-color 0.3s;
        }

        .collapsible:hover {
            background-color: #e0e0e0;
        }

        .content {
            padding: 0 15px;
            display: none;
            overflow: hidden;
            background-color: #fff;
        }

        .unit ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .unit ul li a {
            text-decoration: none;
            color: #0066cc;
        }

        .unit ul li a:hover {
            text-decoration: underline;
        }

        .unit {
            margin-left: 20px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .error {
            text-align: center;
            padding: 20px;
            color: red;
            background: #ffe6e6;
            margin: 10px;
            border-radius: 5px;
        }
    </style>
</head>

<body>

    <!-- Top Nav -->
    <header>
        <nav>
            <button id="toggleBtn" onclick="toggleSidebar()">‚ò∞</button>
            <div class="title">
                <h1>Study Documents</h1>
            </div>
            <div class="logo">
                <img src="GALLERY/image-removebg-preview.png" alt="Chuka University Logo" />
            </div>
        </nav>
    </header>

    <!-- Sidebar -->
    <div id="sidebar">
        <a href="index.html">HOME</a>
        <a href="timetable.html">TIMETABLE</a>
        <a href="assignments.html">ASSIGNMENT</a>
        <a href="studydocs.html">STUDY DOCUMENTS</a>
        <a href="gallery.html">GALLERY</a>
        <a href="sports.html">SPORTS</a>
        <a href="personell.html">PERSONNEL</a>
        <a href="registration.html">SEMESTER REGISTRATION</a>
        <a href="support.html">ACADEMIC SUPPORT</a>
    </div>

    <!-- Main Content -->
    <section class="study-docs">
        <h2 style="margin-top: 25px;">Study Documents</h2>

        <!-- Loading State -->
        <div id="loadingState" class="loading">
            <p>üìö Loading study documents...</p>
        </div>

        <!-- Error State -->
        <div id="errorState" class="error" style="display: none;">
            <p>‚ùå Error loading documents. Please try again later.</p>
        </div>

        <!-- Dynamic Content will be inserted here -->
        <div id="studyDocsContainer"></div>

    </section>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD3oMlsv9C3Qepvkw_Y1JVfhVJiMwZLox4",
            authDomain: "bsceee-webpage.firebaseapp.com",
            databaseURL: "https://bsceee-webpage-default-rtdb.firebaseio.com",
            projectId: "bsceee-webpage",
            storageBucket: "bsceee-webpage.appspot.com",
            messagingSenderId: "281106710079",
            appId: "1:281106710079:web:2c6ab931bc3cab8e4e428a",
            measurementId: "G-B1M7SSEZYP"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Load study documents from Firebase
        function loadStudyDocuments() {
            const loadingElement = document.getElementById('loadingState');
            const errorElement = document.getElementById('errorState');
            const container = document.getElementById('studyDocsContainer');

            db.ref('studyDocuments').once('value')
                .then((snapshot) => {
                    const studyData = snapshot.val();
                    loadingElement.style.display = 'none';

                    if (!studyData) {
                        container.innerHTML = '<p>No study documents available yet.</p>';
                        return;
                    }

                    // Generate HTML from Firebase data
                    container.innerHTML = generateStudyDocsHTML(studyData);

                    // Initialize collapsible functionality
                    initializeCollapsibles();
                })
                .catch((error) => {
                    console.error('Error loading study documents:', error);
                    loadingElement.style.display = 'none';
                    errorElement.style.display = 'block';
                });
        }

        function generateStudyDocsHTML(studyData) {
            let html = '';

            // Get all semesters and sort them logically
            const semesters = Object.keys(studyData);

            // Sort semesters: predefined ones first, then custom ones alphabetically
            const predefinedOrder = ['year1sem1', 'year1sem2', 'year2sem1', 'year2sem2'];
            const customSemesters = semesters.filter(s => !predefinedOrder.includes(s)).sort();
            const sortedSemesters = [...predefinedOrder.filter(s => semesters.includes(s)), ...customSemesters];

            sortedSemesters.forEach(semesterKey => {
                const semesterName = getSemesterDisplayName(semesterKey);
                html += `
            <div class="semester">
                <button class="collapsible">${semesterName}</button>
                <div class="content">`;

                // Sort courses alphabetically
                const sortedCourses = Object.keys(studyData[semesterKey]).sort();

                sortedCourses.forEach(courseCode => {
                    const courseData = studyData[semesterKey][courseCode];
                    html += `
                <div class="unit">
                    <button class="collapsible">${courseCode}</button>
                    <div class="content">
                        <ul>`;

                    // Convert to array and sort by timestamp (newest first)
                    const documents = Object.values(courseData).sort((a, b) =>
                        new Date(b.timestamp) - new Date(a.timestamp)
                    );

                    documents.forEach(doc => {
                        const typeIcon = doc.type === 'exam' ? 'üìù' : doc.type === 'cat' ? 'üìä' : 'üìì';
                        html += `
                        <li><a href="${doc.driveLink}" target="_blank">${typeIcon} ${doc.title}</a></li>`;
                    });

                    html += `
                        </ul>
                    </div>
                </div>`;
                });

                html += `
                </div>
            </div>`;
            });

            return html;
        }

        function getSemesterDisplayName(semesterKey) {
            const names = {
                'year1sem1': 'Year 1 Semester 1',
                'year1sem2': 'Year 1 Semester 2',
                'year2sem1': 'Year 2 Semester 1',
                'year2sem2': 'Year 2 Semester 2'
            };
            // For custom semesters, format them nicely
            if (!names[semesterKey]) {
                // Convert "year3sem1" to "Year 3 Semester 1"
                return semesterKey.replace(/(year)(\d+)(sem)(\d+)/, 'Year $2 Semester $4')
                    .replace(/([a-z])([A-Z])/g, '$1 $2') // Add space between words
                    .replace(/\b\w/g, l => l.toUpperCase()); // Capitalize first letter of each word
            }
            return names[semesterKey];
        }

        // Generate courses HTML for a semester
        function generateCoursesHTML(coursesData) {
            let html = '';

            // Sort courses alphabetically
            const sortedCourses = Object.keys(coursesData).sort();

            sortedCourses.forEach(courseCode => {
                const courseData = coursesData[courseCode];
                html += `
          <div class="unit">
            <button class="collapsible">${courseCode}</button>
            <div class="content">
              ${generateDocumentsHTML(courseData)}
            </div>
          </div>
        `;
            });

            return html;
        }

        // Generate documents list for a course
        function generateDocumentsHTML(courseData) {
            let html = '<ul>';

            // Convert object to array and sort by timestamp (newest first)
            const documents = Object.values(courseData).sort((a, b) =>
                new Date(b.timestamp) - new Date(a.timestamp)
            );

            documents.forEach(doc => {
                html += `
          <li>
            <a href="${doc.driveLink}" target="_blank" rel="noopener">
              ${doc.title}
              ${getDocTypeBadge(doc.type)}
            </a>
          </li>
        `;
            });

            html += '</ul>';
            return html;
        }

        // Helper function to get semester display name
        function getSemesterDisplayName(semesterKey) {
            const names = {
                'year1sem1': 'Year 1 Semester 1',
                'year1sem2': 'Year 1 Semester 2',
                'year2sem1': 'Year 2 Semester 1',
                'year2sem2': 'Year 2 Semester 2'
            };
            return names[semesterKey] || semesterKey;
        }

        // Helper function to get document type badge
        function getDocTypeBadge(type) {
            const badges = {
                'exam': ' üìù',
                'cat': ' üìä',
                'notes': ' üìì',
                'other': ' üìé'
            };
            return badges[type] || '';
        }

        // Initialize collapsible functionality
        function initializeCollapsibles() {
            const collapsibles = document.querySelectorAll(".collapsible");
            collapsibles.forEach(button => {
                button.addEventListener("click", function () {
                    this.classList.toggle("active");
                    const content = this.nextElementSibling;
                    content.style.display = content.style.display === "block" ? "none" : "block";
                });
            });
        }

        // Your existing sidebar functions
        function toggleSidebar() {
            document.getElementById("sidebar").classList.toggle("active");
        }

        // Load documents when page loads
        document.addEventListener("DOMContentLoaded", function () {
            loadStudyDocuments();
        });
    </script>

    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-links">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="https://www.chuka.ac.ke" target="_blank">Chuka University Website</a></li>
                    <li><a href="https://portal.chuka.ac.ke" target="_blank">Student Portal</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 BSCEEE Y2S1 ¬∑ Chuka University</p>
        </div>
    </footer>
</body>

</html>

